{"version":3,"sources":["../src/ClayModal.js"],"names":["KEY_CODE_ESC","KEY_CODE_TAB","FOCUSABLE_ELEMENTS","ClayModal","_overlayElement","_valueOverlayElementFn","_eventHandler","EventHandler","addListener","_handleDocumentClick","bind","_defaultHideModal","_defaultShowModal","_handleTransitionEnd","removeAllListeners","_isTransitioning","visible","dom","enterDocument","offsetHeight","addClasses","exitDocument","removeClasses","document","body","add","on","_handleKeyup","_handleKeyDown","nodes","element","querySelectorAll","Object","keys","map","key","event","keyCode","contains","target","focus","focusableNodes","_getFocusableNodes","focusedItemIndex","indexOf","activeElement","shiftKey","length","preventDefault","emit","buildFragment","firstChild","ClayComponent","STATE","Config","any","data","object","defaultEventHandler","elementClasses","string","footerButtons","arrayOf","shapeOf","alignment","oneOf","value","label","required","style","type","id","bool","internal","size","spritemap","status","title","url","Soy","register","templates"],"mappings":"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","file":"ClayModal.js","sourcesContent":["import 'clay-button';\nimport 'clay-icon';\nimport {Config} from 'metal-state';\nimport {EventHandler} from 'metal-events';\nimport ClayComponent from 'clay-component';\nimport defineWebComponent from 'metal-web-component';\nimport dom from 'metal-dom';\nimport Soy from 'metal-soy';\n\nimport templates from './ClayModal.soy.js';\n\nconst KEY_CODE_ESC = 27;\nconst KEY_CODE_TAB = 9;\n\nconst FOCUSABLE_ELEMENTS = [\n\t'a[href]',\n\t'[contenteditable]',\n\t'[tabindex]:not([tabindex^=\"-\"])',\n\t'area[href]',\n\t'button:not([disabled]):not([aria-hidden])',\n\t'embed',\n\t'iframe',\n\t'input:not([disabled]):not([type=\"hidden\"]):not([aria-hidden])',\n\t'object',\n\t'select:not([disabled]):not([aria-hidden])',\n\t'textarea:not([disabled]):not([aria-hidden])',\n];\n\n/**\n * Metal ClayModal component.\n * @extends ClayComponent\n */\nclass ClayModal extends ClayComponent {\n\t/**\n\t * @inheritDoc\n\t */\n\tcreated() {\n\t\tthis._overlayElement = this._valueOverlayElementFn();\n\t\tthis._eventHandler = new EventHandler();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tattached() {\n\t\tthis.addListener('click', this._handleDocumentClick.bind(this), true);\n\t\tthis.addListener('hide', this._defaultHideModal, true);\n\t\tthis.addListener('show', this._defaultShowModal, true);\n\t\tthis.addListener(\n\t\t\t'touchend',\n\t\t\tthis._handleDocumentClick.bind(this),\n\t\t\ttrue\n\t\t);\n\t\tthis.addListener('transitionend', this._handleTransitionEnd, true);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tdetached() {\n\t\tsuper.detached();\n\t\tthis._eventHandler.removeAllListeners();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\t// eslint-disable-next-line\n\tsync_isTransitioning() {\n\t\tif (this._isTransitioning && !this.visible) {\n\t\t\tthis._isTransitioning = false;\n\t\t\tthis.visible = true;\n\t\t} else if (this._isTransitioning && this.visible) {\n\t\t\tthis.visible = false;\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tsyncVisible() {\n\t\tif (this.visible) {\n\t\t\tdom.enterDocument(this._overlayElement);\n\t\t\tthis._overlayElement.offsetHeight;\n\t\t\tdom.addClasses(this._overlayElement, 'show');\n\t\t} else {\n\t\t\tdom.exitDocument(this._overlayElement);\n\t\t}\n\t}\n\n\t/**\n\t * Close modal and remove transitions.\n\t * @private\n\t */\n\t_defaultHideModal() {\n\t\tdom.removeClasses(this._overlayElement, 'show');\n\t\tdom.removeClasses(document.body, 'modal-open');\n\n\t\tthis._isTransitioning = true;\n\n\t\tthis._eventHandler.removeAllListeners();\n\t}\n\n\t/**\n\t * Open modal and add transition.\n\t * @private\n\t */\n\t_defaultShowModal() {\n\t\tdom.addClasses(document.body, 'modal-open');\n\n\t\tthis._isTransitioning = true;\n\n\t\tthis._eventHandler.add(\n\t\t\tdom.on(document, 'keyup', this._handleKeyup.bind(this)),\n\t\t\tdom.on(document, 'keydown', this._handleKeyDown.bind(this))\n\t\t);\n\t}\n\n\t/**\n\t * Get all nodes that can be focused.\n\t * @protected\n\t * @return {!Array}\n\t */\n\t_getFocusableNodes() {\n\t\tconst nodes = this.element.querySelectorAll(FOCUSABLE_ELEMENTS);\n\t\treturn Object.keys(nodes).map(key => nodes[key]);\n\t}\n\n\t/**\n\t * Handles the focus on the elements within the modal.\n\t * @param {!Event} event\n\t * @protected\n\t */\n\t_handleKeyDown(event) {\n\t\tif (event.keyCode === KEY_CODE_TAB) {\n\t\t\tif (!this.element.contains(event.target)) {\n\t\t\t\tthis.element.focus();\n\t\t\t} else {\n\t\t\t\tconst focusableNodes = this._getFocusableNodes();\n\t\t\t\tconst focusedItemIndex = focusableNodes.indexOf(\n\t\t\t\t\tdocument.activeElement\n\t\t\t\t);\n\n\t\t\t\tif (event.shiftKey && focusedItemIndex === 0) {\n\t\t\t\t\tfocusableNodes[focusableNodes.length - 1].focus();\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\t!event.shiftKey &&\n\t\t\t\t\tfocusedItemIndex === focusableNodes.length - 1\n\t\t\t\t) {\n\t\t\t\t\tfocusableNodes[0].focus();\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Handle the click buttons and emit event.\n\t * @param {!Event} event\n\t * @private\n\t */\n\t_handleClickFooterButton(event) {\n\t\tthis.emit('clickButton', event);\n\t}\n\n\t/**\n\t * Handle the footer close button click and emits events.\n\t * @param {!Event} event\n\t * @private\n\t */\n\t_handleClickCloseButtonFooter(event) {\n\t\tthis.emit('clickButton', event);\n\t\tthis.emit('hide');\n\t}\n\n\t/**\n\t * Handle the click and emit close modal.\n\t * @private\n\t */\n\t_handleCloseModal() {\n\t\tthis.emit('hide');\n\t}\n\n\t/**\n\t * Check if contain click target event in element and emit close modal.\n\t * @param {!Event} event\n\t * @private\n\t */\n\t_handleDocumentClick(event) {\n\t\tif (dom.contains(event.target, this.element)) {\n\t\t\tthis.emit('hide');\n\t\t}\n\t}\n\n\t/**\n\t * Handle click key code esc and emit close modal.\n\t * @param {!Event} event\n\t * @private\n\t */\n\t_handleKeyup(event) {\n\t\tif (event.keyCode === KEY_CODE_ESC) {\n\t\t\tthis.emit('hide');\n\t\t}\n\t}\n\n\t/**\n\t * Handle css transition ends.\n\t * @param {!Event} event\n\t * @private\n\t */\n\t_handleTransitionEnd(event) {\n\t\tif (\n\t\t\tevent.target === this.element &&\n\t\t\tthis._isTransitioning &&\n\t\t\t!this.visible\n\t\t) {\n\t\t\tthis._isTransitioning = false;\n\t\t}\n\t}\n\n\t/**\n\t * Create fragment of the overlay modal.\n\t * @return {Element} The resulting document fragment.\n\t * @private\n\t */\n\t_valueOverlayElementFn() {\n\t\treturn dom.buildFragment('<div class=\"modal-backdrop fade\"></div>')\n\t\t\t.firstChild;\n\t}\n\n\t/**\n\t * Emit open modal.\n\t * @public\n\t */\n\tshow() {\n\t\tthis.emit('show');\n\t}\n}\n\n/**\n * State definition.\n * @static\n * @type {!Object}\n */\nClayModal.STATE = {\n\t/**\n\t * Body of the modal.\n\t * @default undefined\n\t * @instance\n\t * @memberof ClayModal\n\t * @type {?(string|html|undefined)}\n\t */\n\tbody: Config.any(),\n\n\t/**\n\t * Data to add to the element.\n\t * @default undefined\n\t * @instance\n\t * @memberof ClayModal\n\t * @type {?object}\n\t */\n\tdata: Config.object(),\n\n\t/**\n\t * Object that wires events with default listeners\n\t * @default undefined\n\t * @instance\n\t * @memberof ClayModal\n\t * @review\n\t * @type {?(object|undefined)}\n\t */\n\tdefaultEventHandler: Config.object(),\n\n\t/**\n\t * CSS classes to be applied to the element.\n\t * @default undefined\n\t * @instance\n\t * @memberof ClayModal\n\t * @type {?(string|undefined)}\n\t */\n\telementClasses: Config.string(),\n\n\t/**\n\t * Buttons of the footer.\n\t * @default undefined\n\t * @instance\n\t * @memberof ClayModal\n\t * @type {?(array|undefined)}\n\t */\n\tfooterButtons: Config.arrayOf(\n\t\tConfig.shapeOf({\n\t\t\talignment: Config.oneOf(['left', 'right']).value('right'),\n\t\t\tlabel: Config.string().required(),\n\t\t\tstyle: Config.oneOf(['link', 'primary', 'secondary', 'unstyled']),\n\t\t\ttype: Config.oneOf(['button', 'close', 'reset', 'submit']).value(\n\t\t\t\t'button'\n\t\t\t),\n\t\t})\n\t),\n\n\t/**\n\t * Id to be applied to the element.\n\t * @default undefined\n\t * @instance\n\t * @memberof ClayModal\n\t * @type {?(string|undefined)}\n\t */\n\tid: Config.string(),\n\n\t/**\n\t * Adds transitions when show is called.\n\t * @default false\n\t * @instance\n\t * @memberof ClayModal\n\t * @private\n\t * @type {?bool}\n\t */\n\t_isTransitioning: Config.bool()\n\t\t.value(false)\n\t\t.internal(),\n\n\t/**\n\t * The size of element modal.\n\t * @default undefined\n\t * @instance\n\t * @memberof ClayModal\n\t * @type {?(string|undefined)}\n\t */\n\tsize: Config.oneOf(['full-screen', 'lg', 'sm']),\n\n\t/**\n\t * The path to the SVG spritemap file containing the icons.\n\t * @default undefined\n\t * @instance\n\t * @memberof ClayModal\n\t * @type {?(string|undefined)}\n\t */\n\tspritemap: Config.string(),\n\n\t/**\n\t * Status messages.\n\t * @default undefined\n\t * @instance\n\t * @memberof ClayModal\n\t * @type {?(string|undefined)}\n\t */\n\tstatus: Config.oneOf(['danger', 'info', 'success', 'warning']),\n\n\t/**\n\t * Title of the modal.\n\t * @default undefined\n\t * @instance\n\t * @memberof ClayModal\n\t * @type {?(string|undefined)}\n\t */\n\ttitle: Config.string(),\n\n\t/**\n\t * Url to place an iframe in the body of the modal.\n\t * @default undefined\n\t * @instance\n\t * @memberof ClayModal\n\t * @type {?(string|undefined)}\n\t */\n\turl: Config.string(),\n\n\t/**\n\t * Modal visible when show is called.\n\t * @default false\n\t * @instance\n\t * @memberof ClayModal\n\t * @private\n\t * @type {?bool}\n\t */\n\tvisible: Config.bool().value(false),\n};\n\ndefineWebComponent('clay-modal', ClayModal);\n\nSoy.register(ClayModal, templates);\n\nexport {ClayModal};\nexport default ClayModal;\n"]}