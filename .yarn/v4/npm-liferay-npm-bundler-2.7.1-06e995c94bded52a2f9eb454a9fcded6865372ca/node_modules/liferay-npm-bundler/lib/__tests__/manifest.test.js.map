{"version":3,"sources":["../../src/__tests__/manifest.test.js"],"names":["it","manifest","srcPkg","destPkg","addPackage","expect","getPackage","toMatchSnapshot","resolve","entry","src","dir","toBe","dest","describe","srcPkg1","destPkg1","srcPkg2","destPkg2","tmpDir","mkdtempSync","tmpFilePath","join","save","readFileSync","toString","unlinkSync","rmdirSync","toThrow","manifest2","toJSON","isOutdated"],"mappings":"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","file":"manifest.test.js","sourcesContent":["/**\n * Â© 2017 Liferay, Inc. <https://liferay.com>\n *\n * SPDX-License-Identifier: LGPL-3.0-or-later\n */\n\nimport {Manifest} from '../manifest';\n\nimport fs from 'fs';\nimport PkgDesc from 'liferay-npm-build-tools-common/lib/pkg-desc';\nimport path from 'path';\n\nit('addPackage/getPackage work', () => {\n\tconst manifest = new Manifest();\n\n\tconst srcPkg = new PkgDesc('a-package', '1.0.0', './src');\n\tconst destPkg = new PkgDesc('a-package', '1.0.0', './dest');\n\n\tmanifest.addPackage(srcPkg, destPkg);\n\n\texpect(manifest.getPackage(srcPkg)).toMatchSnapshot();\n});\n\nit('getPackage returns entries with relative paths', () => {\n\tconst manifest = new Manifest();\n\n\tconst srcPkg = new PkgDesc('a-package', '1.0.0', path.resolve('./src'));\n\tconst destPkg = new PkgDesc('a-package', '1.0.0', path.resolve('./dest'));\n\n\tmanifest.addPackage(srcPkg, destPkg);\n\n\tconst entry = manifest.getPackage(srcPkg);\n\n\texpect(entry.src.dir).toBe('./src');\n\texpect(entry.dest.dir).toBe('./dest');\n});\n\ndescribe('save', () => {\n\tit('works', () => {\n\t\tconst manifest = new Manifest();\n\n\t\tconst srcPkg1 = new PkgDesc('a-package', '1.0.0', './src-1');\n\t\tconst destPkg1 = new PkgDesc('a-package', '1.0.0', './dest-1');\n\n\t\tconst srcPkg2 = new PkgDesc('a-package', '2.0.0', './src-2');\n\t\tconst destPkg2 = new PkgDesc('a-package', '2.0.0', './dest-2');\n\n\t\tmanifest.addPackage(srcPkg1, destPkg1);\n\t\tmanifest.addPackage(srcPkg2, destPkg2);\n\n\t\tconst tmpDir = fs.mkdtempSync('manifest');\n\t\tconst tmpFilePath = path.join(tmpDir, 'manifest.json');\n\n\t\tmanifest.save(tmpFilePath);\n\n\t\texpect(fs.readFileSync(tmpFilePath).toString()).toMatchSnapshot();\n\n\t\tfs.unlinkSync(tmpFilePath);\n\t\tfs.rmdirSync(tmpDir);\n\t});\n\n\tit('throws if called with no path and no default file path is set', () => {\n\t\tconst manifest = new Manifest();\n\n\t\texpect(() => manifest.save()).toThrow();\n\t});\n});\n\nit('constructor with file works', () => {\n\tconst tmpDir = fs.mkdtempSync('manifest');\n\tconst tmpFilePath = path.join(tmpDir, 'manifest.json');\n\n\tconst manifest = new Manifest(tmpFilePath);\n\n\tconst srcPkg1 = new PkgDesc('a-package', '1.0.0', './src-1');\n\tconst destPkg1 = new PkgDesc('a-package', '1.0.0', './dest-1');\n\n\tconst srcPkg2 = new PkgDesc('a-package', '2.0.0', './src-2');\n\tconst destPkg2 = new PkgDesc('a-package', '2.0.0', './dest-2');\n\n\tmanifest.addPackage(srcPkg1, destPkg1);\n\tmanifest.addPackage(srcPkg2, destPkg2);\n\n\tmanifest.save();\n\n\tconst manifest2 = new Manifest(tmpFilePath);\n\n\texpect(manifest2.toJSON()).toMatchSnapshot();\n\n\tfs.unlinkSync(tmpFilePath);\n\tfs.rmdirSync(tmpDir);\n});\n\ndescribe('isOutdated', () => {\n\tit('returns false for up-to-date packages', () => {\n\t\tconst manifest = new Manifest();\n\n\t\tconst srcPkg = new PkgDesc('a-package', '1.0.0', './src');\n\t\tconst destPkg = new PkgDesc('a-package', '1.0.0', '.');\n\n\t\tmanifest.addPackage(srcPkg, destPkg);\n\n\t\texpect(manifest.isOutdated(srcPkg)).toBe(false);\n\t});\n\n\t// TODO: This test can be removed if we implement enhanced outdated detection by using timestamps/digests.\n\t// However, we are not sure that it is the bundler's responsibility to detect such modifications as it is\n\t// more a multi-tool build issue that may happen with other configurations.\n\tit('returns true for root package no matter what', () => {\n\t\tconst manifest = new Manifest();\n\n\t\tconst srcPkg = new PkgDesc('a-package', '1.0.0', './src', true);\n\t\tconst destPkg = new PkgDesc('a-package', '1.0.0', '.', true);\n\n\t\tmanifest.addPackage(srcPkg, destPkg);\n\n\t\texpect(manifest.isOutdated(srcPkg)).toBe(true);\n\t});\n\n\tit('returns true for unregistered packages', () => {\n\t\tconst manifest = new Manifest();\n\n\t\tconst srcPkg = new PkgDesc('a-package', '1.0.0', './src');\n\n\t\texpect(manifest.isOutdated(srcPkg)).toBe(true);\n\t});\n\n\tit('returns true for packages with missing destination directory', () => {\n\t\tconst manifest = new Manifest();\n\n\t\tconst srcPkg = new PkgDesc('a-package', '1.0.0', './src');\n\t\tconst destPkg = new PkgDesc('a-package', '1.0.0', './non-existing-dir');\n\n\t\tmanifest.addPackage(srcPkg, destPkg);\n\n\t\texpect(manifest.isOutdated(srcPkg)).toBe(true);\n\t});\n});\n"]}