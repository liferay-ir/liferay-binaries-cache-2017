{"version":3,"sources":["../../src/__tests__/dependencies.test.js"],"names":["expect","extend","toMatchDependencies","deps","pkgIds","missingDeps","extraDeps","invalidDepFields","forEach","dep","pkgId","push","pkgName","pkgVersion","ROOT_ID","pkgIdParts","split","invalidFields","id","name","version","expectedDepDir","normalize","dir","endsWith","Object","keys","length","indexOf","depId","pass","message","JSON","stringify","savedCwd","process","cwd","beforeAll","chdir","join","__dirname","afterAll","it"],"mappings":"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","file":"dependencies.test.js","sourcesContent":["/**\n * Â© 2017 Liferay, Inc. <https://liferay.com>\n *\n * SPDX-License-Identifier: LGPL-3.0-or-later\n */\n\nimport PkgDesc from 'liferay-npm-build-tools-common/lib/pkg-desc';\nimport path from 'path';\nimport {addPackageDependencies} from '../dependencies';\n\nexpect.extend({\n\ttoMatchDependencies(deps, ...pkgIds) {\n\t\tconst missingDeps = [];\n\t\tconst extraDeps = [];\n\t\tconst invalidDepFields = {};\n\n\t\tpkgIds.forEach(pkgId => {\n\t\t\tconst dep = deps[pkgId];\n\n\t\t\tif (!dep) {\n\t\t\t\tmissingDeps.push(pkgId);\n\t\t\t} else {\n\t\t\t\tlet pkgName;\n\t\t\t\tlet pkgVersion;\n\n\t\t\t\tif (pkgId === PkgDesc.ROOT_ID) {\n\t\t\t\t\tpkgName = 'test-project';\n\t\t\t\t\tpkgVersion = '1.0.0';\n\t\t\t\t} else {\n\t\t\t\t\tconst pkgIdParts = pkgId.split('@');\n\t\t\t\t\tpkgName = pkgIdParts[0];\n\t\t\t\t\tpkgVersion = pkgIdParts[1];\n\t\t\t\t}\n\n\t\t\t\tconst invalidFields = invalidDepFields[pkgId] || {};\n\n\t\t\t\tif (dep.id != pkgId) {\n\t\t\t\t\tinvalidFields.id = `${dep.id} (expected: ${pkgId})`;\n\t\t\t\t}\n\n\t\t\t\tif (dep.name != pkgName) {\n\t\t\t\t\tinvalidFields.name = `${dep.name} (expected: ${pkgName})`;\n\t\t\t\t}\n\n\t\t\t\tif (dep.version != pkgVersion) {\n\t\t\t\t\tinvalidFields.version =\n\t\t\t\t\t\t`${dep.version} ` + `(expected: ${pkgVersion})`;\n\t\t\t\t}\n\n\t\t\t\tconst expectedDepDir =\n\t\t\t\t\tpkgId === PkgDesc.ROOT_ID\n\t\t\t\t\t\t? path.normalize('.')\n\t\t\t\t\t\t: path.normalize(`/node_modules/${pkgName}`);\n\n\t\t\t\tif (dep.dir !== '.' && !dep.dir.endsWith(expectedDepDir)) {\n\t\t\t\t\tinvalidFields.dir =\n\t\t\t\t\t\t`${dep.dir} ` + `(expected: ${expectedDepDir})`;\n\t\t\t\t}\n\n\t\t\t\tif (Object.keys(invalidFields).length > 0) {\n\t\t\t\t\tinvalidDepFields[pkgId] = invalidFields;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tObject.keys(deps).forEach(depId => {\n\t\t\tif (pkgIds.indexOf(depId) == -1) {\n\t\t\t\textraDeps.push(depId);\n\t\t\t}\n\t\t});\n\n\t\tlet pass = true;\n\t\tlet message = '';\n\n\t\tif (missingDeps.length > 0) {\n\t\t\tmessage += `\\nRequired dependencies missing: ${missingDeps}\\n`;\n\t\t\tpass = false;\n\t\t}\n\n\t\tif (extraDeps.length > 0) {\n\t\t\tmessage += `\\nNot required dependencies found: ${extraDeps}\\n`;\n\t\t\tpass = false;\n\t\t}\n\n\t\tif (Object.keys(invalidDepFields).length > 0) {\n\t\t\tmessage += `\\nInvalid dependency fields: ${JSON.stringify(\n\t\t\t\tinvalidDepFields,\n\t\t\t\t'',\n\t\t\t\t2\n\t\t\t)}\\n`;\n\t\t\tpass = false;\n\t\t}\n\n\t\treturn {\n\t\t\tmessage,\n\t\t\tpass,\n\t\t};\n\t},\n});\n\nconst savedCwd = process.cwd();\n\nbeforeAll(() => {\n\tprocess.chdir(path.join(__dirname, '__fixtures__', 'project'));\n});\n\nafterAll(() => {\n\tprocess.chdir(savedCwd);\n});\n\nit('loads project dependencies correctly', () => {\n\tconst deps = addPackageDependencies({}, '.');\n\n\texpect(deps).toMatchDependencies(\n\t\tPkgDesc.ROOT_ID,\n\t\t'test-project-dep-0@1.0.0',\n\t\t'test-project-dep-1@1.0.0',\n\t\t'test-project-dep-0@0.1.0'\n\t);\n});\n\nit('appends extra dependencies correctly', () => {\n\tconst deps = addPackageDependencies({}, '.', ['stale-package']);\n\n\texpect(deps).toMatchDependencies(\n\t\t'stale-package@1.0.0',\n\t\tPkgDesc.ROOT_ID,\n\t\t'test-project-dep-0@1.0.0',\n\t\t'test-project-dep-1@1.0.0',\n\t\t'test-project-dep-0@0.1.0'\n\t);\n});\n"]}