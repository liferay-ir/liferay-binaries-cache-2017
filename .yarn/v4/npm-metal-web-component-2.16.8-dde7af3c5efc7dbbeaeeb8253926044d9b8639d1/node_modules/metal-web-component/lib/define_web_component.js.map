{"version":3,"sources":["../src/define_web_component.js"],"names":["defineWebComponent","tagName","Ctor","window","observedAttributes","Object","keys","getStateStatic","props","hasProps","length","CustomElement","Reflect","construct","HTMLElement","setPrototypeOf","prototype","assign","attributeChangedCallback","attrName","oldVal","newVal","component","deserializeValue_","componentHasProps","connectedCallback","useShadowDOM","getAttribute","element","attachShadow","mode","opts","i","l","deserializedValue","componentEventHandler","emit","bind","on","value","retVal","JSON","parse","e","disconnectedCallback","off","dispose","data","eventData","pop","event","CustomEvent","type","detail","dispatchEvent","customElements","define"],"mappings":"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","file":"define_web_component.js","sourcesContent":["import State, {mergeState} from 'metal-state';\nimport {getStaticProperty, isObject} from 'metal';\n\n/**\n * Register a custom element for a given Metal component.\n *\n * @param {String} tagName The tag name to use for this custom element.\n * @param {!function()} Ctor Metal component constructor.\n * @return {void} Nothing.\n */\nexport function defineWebComponent(tagName, Ctor) {\n\tif (!('customElements' in window)) {\n\t\treturn;\n\t}\n\n\tlet observedAttributes = Object.keys(State.getStateStatic(Ctor));\n\n\tconst props = getStaticProperty(Ctor, 'PROPS', mergeState);\n\n\tconst hasProps = isObject(props) && Object.keys(props).length;\n\n\tif (hasProps) {\n\t\tobservedAttributes = Object.keys(props);\n\t}\n\n\t/**\n\t * Custom Element wrapper for Metal components.\n\t *\n\t * @constructor\n\t * @extends HTMLElement\n\t */\n\tfunction CustomElement() {\n\t\treturn Reflect.construct(HTMLElement, [], CustomElement);\n\t}\n\n\tCustomElement.observedAttributes = observedAttributes;\n\n\tObject.setPrototypeOf(CustomElement.prototype, HTMLElement.prototype);\n\tObject.setPrototypeOf(CustomElement, HTMLElement);\n\n\tObject.assign(CustomElement.prototype, {\n\t\t/**\n\t\t * Handler for when new attribute values are passed to the custom\n\t\t * element.\n\t\t *\n\t\t * @memberof CustomElement\n\t\t * @param {!string} attrName name of the changed attribute.\n\t\t * @param {!string} oldVal previous value of the attribute.\n\t\t * @param {!string} newVal new value of the attribute\n\t\t */\n\t\tattributeChangedCallback: function(attrName, oldVal, newVal) {\n\t\t\tif (!this.component) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tnewVal = this.deserializeValue_(newVal);\n\n\t\t\tif (this.componentHasProps) {\n\t\t\t\tthis.component.props[attrName] = newVal;\n\t\t\t} else {\n\t\t\t\tthis.component[attrName] = newVal;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Handles the initial rendering of the Metal component. Invoked when\n\t\t * the custom element enters the document.\n\t\t *\n\t\t * @memberof CustomElement\n\t\t */\n\t\tconnectedCallback: function() {\n\t\t\tconst useShadowDOM = this.getAttribute('useShadowDOM') || false;\n\t\t\tlet element = this;\n\n\t\t\tif (useShadowDOM) {\n\t\t\t\telement = this.attachShadow({\n\t\t\t\t\tmode: 'open',\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst opts = {};\n\t\t\tfor (let i = 0, l = observedAttributes.length; i < l; i++) {\n\t\t\t\tconst deserializedValue = this.deserializeValue_(\n\t\t\t\t\tthis.getAttribute(observedAttributes[i])\n\t\t\t\t);\n\n\t\t\t\tif (deserializedValue) {\n\t\t\t\t\topts[observedAttributes[i]] = deserializedValue;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.component = new Ctor(opts, element);\n\t\t\tthis.componentHasProps = hasProps;\n\t\t\tthis.componentEventHandler = this.emit.bind(this);\n\n\t\t\tthis.component.on('*', this.componentEventHandler);\n\t\t},\n\n\t\t/**\n\t\t * Parses attribute value as JSON in case it is an Array or Object.\n\t\t *\n\t\t * @memberof CustomElement\n\t\t * @param {?} value attribute value that should be parsed.\n\t\t * @return {Object}\n\t\t */\n\t\tdeserializeValue_: function(value) {\n\t\t\tlet retVal;\n\n\t\t\ttry {\n\t\t\t\tretVal = JSON.parse(value);\n\t\t\t} catch (e) {}\n\n\t\t\treturn retVal || value;\n\t\t},\n\n\t\t/**\n\t\t * Disposes the Metal component and detaches event listeners. Invoked\n\t\t * once the custom element exits the document.\n\t\t *\n\t\t * @memberof CustomElement\n\t\t */\n\t\tdisconnectedCallback: function() {\n\t\t\tthis.component.off('*', this.componentEventHandler);\n\t\t\tthis.component.dispose();\n\t\t},\n\n\t\t/**\n\t\t * Proxy event handler that passes event payloads from Metal component\n\t\t * events to custom element events.\n\t\t *\n\t\t * @memberof CustomElement\n\t\t * @param {?} data data emitted from Metal component event\n\t\t */\n\t\temit: function(...data) {\n\t\t\tconst eventData = data.pop();\n\t\t\tconst event = new CustomEvent(eventData.type, {\n\t\t\t\tdetail: data,\n\t\t\t});\n\t\t\tthis.dispatchEvent(event);\n\t\t},\n\t});\n\n\twindow.customElements.define(tagName, CustomElement);\n}\n\nexport default defineWebComponent;\n"]}