{"version":3,"sources":["../src/ClayDropdownBase.js"],"names":["KEY_CODE_ESC","KEY_ESCAPE","KEY_TAB","flatten","items","groupItems","newItems","map","item","reduce","acc","cur","concat","ClayDropdownBase","addListener","_defaultToggle","refs","portal","on","_handleRenderedPortal","bind","_eventHandler","EventHandler","removeAllListeners","flattenedItems","i","expanded","element","Array","prototype","indexOf","call","filter","parentElement","children","childrenElement","getAttribute","initialActive","initialSubActive","reverse","_incrementActiveItemIndex","active","subActive","allItems","prev","curr","tick","disabled","length","event","contains","target","toggle","emit","delegateTarget","elementIndex","_getDropdownItemIndex","flatenItems","data","name","originalEvent","key","totalElements","querySelectorAll","shiftKey","preventDefault","triggerButton","focus","keyCode","_alignElementSelector","alignElement","querySelector","bodyElement","menu","_alignedPosition","Align","align","preferredAlign","searchValue","value","toLowerCase","_originalItems","nestedItem","label","type","filteredItems","originalItems","item0","activeElement","document","nodeName","totalItems","nextActive","activeSubIndex","activeIndex","findIndex","subIndex","_getNextIndexes","_assembleFromFlattenedGroups","TopCenter","RightCenter","BottomCenter","LeftCenter","TopRight","BottomRight","BottomLeft","TopLeft","add","dom","_handleDocClick","window","_handleWinBlur","eventHandles_","ClayComponent","STATE","Config","validator","isValidPosition","internal","string","button","shapeOf","href","required","style","oneOf","caption","contentRenderer","object","defaultEventHandler","bool","elementClasses","helpText","id","itemsValidator","itemsIconAlignment","any","portalElementId","setter","searchable","spritemap","triggerAriaLabel","triggerClasses","triggerSize","triggerTitle","Soy","register","templates"],"mappings":"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","file":"ClayDropdownBase.js","sourcesContent":["import 'clay-button';\nimport 'clay-link';\nimport 'clay-portal';\nimport './ClayDropdownItem';\nimport ClayComponent from 'clay-component';\nimport Soy from 'metal-soy';\nimport dom from 'metal-dom';\nimport {Align} from 'metal-position';\nimport {Config} from 'metal-state';\nimport {EventHandler} from 'metal-events';\n\nimport {itemsValidator, preferredAlign} from './validators';\nimport templates from './ClayDropdownBase.soy.js';\n\nconst KEY_CODE_ESC = 27;\n\nconst KEY_ESCAPE = 'Escape';\nconst KEY_TAB = 'Tab';\n\n/**\n * Flattens all items into an array of arrays.\n * @param {Array} items\n * @param {Bool} groupItems This keeps items in their original groupings\n * @private\n * @return {Array}\n */\nconst flatten = (items, groupItems) => {\n\tconst newItems = items.map(item => (item.items ? item.items : [item]));\n\n\treturn groupItems\n\t\t? newItems\n\t\t: newItems.reduce((acc, cur) => acc.concat(cur), []);\n};\n\n/**\n * Implementation of the base for Metal Clay Dropdown.\n * @extends ClayComponent\n */\nclass ClayDropdownBase extends ClayComponent {\n\t/**\n\t * @inheritDoc\n\t */\n\tattached() {\n\t\tthis.addListener('toggle', this._defaultToggle, true);\n\t\tthis.refs.portal.on('rendered', this._handleRenderedPortal.bind(this));\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tcreated() {\n\t\tthis._eventHandler = new EventHandler();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tdetached() {\n\t\tthis._eventHandler.removeAllListeners();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tdisposed() {\n\t\tthis._eventHandler.removeAllListeners();\n\t}\n\n\t/**\n\t * Reassembles flattened items into the correct items structure.\n\t * This method is used in conjunction with `flatten(..., true)`\n\t * @param {Array} flattenedItems\n\t * @private\n\t * @return {Array}\n\t */\n\t_assembleFromFlattenedGroups(flattenedItems) {\n\t\treturn this.items.map((item, i) => {\n\t\t\tif (item.items) {\n\t\t\t\titem.items = flattenedItems[i];\n\t\t\t} else {\n\t\t\t\titem = flattenedItems[i][0];\n\t\t\t}\n\n\t\t\treturn item;\n\t\t});\n\t}\n\n\t/**\n\t * Toggles the dropdown, closing it when open or opening it when closed.\n\t * @protected\n\t */\n\t_defaultToggle() {\n\t\tthis.expanded = !this.expanded;\n\t}\n\n\t/**\n\t * Returns the dropdown index of the element.\n\t * @param {!Node} element\n\t * @private\n\t * @return {?array|undefined} the index.\n\t */\n\t_getDropdownItemIndex(element) {\n\t\treturn Array.prototype.indexOf.call(\n\t\t\tArray.prototype.filter.call(\n\t\t\t\telement.parentElement.children,\n\t\t\t\tchildrenElement =>\n\t\t\t\t\tchildrenElement.getAttribute('role') !== 'presentation'\n\t\t\t),\n\t\t\telement\n\t\t);\n\t}\n\n\t/**\n\t * Gets the indexes of the next active item.\n\t * @param {Array} items\n\t * @param {Number} initialActive\n\t * @param {Number} initialSubActive\n\t * @param {Boolean} reverse\n\t * @private\n\t * @return {Number}\n\t */\n\t_getNextIndexes(items, initialActive, initialSubActive, reverse = false) {\n\t\tlet {active, subActive} = this._incrementActiveItemIndex(\n\t\t\titems,\n\t\t\tinitialActive === -1 ? 0 : initialActive,\n\t\t\tinitialSubActive,\n\t\t\treverse\n\t\t);\n\n\t\tconst allItems = items.reduce((prev, curr) => prev.concat(curr), []);\n\n\t\tlet tick = 0;\n\n\t\twhile (items[active][subActive].disabled && tick < allItems.length) {\n\t\t\tconst item = this._incrementActiveItemIndex(\n\t\t\t\titems,\n\t\t\t\tactive,\n\t\t\t\tsubActive,\n\t\t\t\treverse\n\t\t\t);\n\n\t\t\tactive = item.active;\n\t\t\tsubActive = item.subActive;\n\n\t\t\ttick++;\n\t\t}\n\n\t\treturn {active, subActive};\n\t}\n\n\t/**\n\t * Handles document click in order to hide menu.\n\t * @param {!Event} event\n\t * @protected\n\t */\n\t_handleDocClick(event) {\n\t\tif (\n\t\t\tthis.element.contains(event.target) ||\n\t\t\t(this.refs.portal &&\n\t\t\t\tthis.refs.portal.element.contains(event.target))\n\t\t) {\n\t\t\treturn;\n\t\t}\n\t\tthis.toggle();\n\t}\n\n\t/**\n\t * Handles footer button click.\n\t * @param {!Event} event\n\t * @protected\n\t */\n\t_handleButtonClick(event) {\n\t\tthis.emit('buttonClicked', event);\n\t}\n\n\t/**\n\t * Continues the propagation of the item clicked event\n\t * @param {!Event} event\n\t * @protected\n\t * @return {Boolean} If the event has been prevented or not.\n\t */\n\t_handleItemClick(event) {\n\t\tconst element = event.delegateTarget;\n\t\tconst elementIndex = this._getDropdownItemIndex(element);\n\t\tconst flatenItems = flatten(this.items);\n\t\tconst item = flatenItems[elementIndex];\n\n\t\treturn !this.emit({\n\t\t\tdata: {\n\t\t\t\titem: item,\n\t\t\t},\n\t\t\tname: 'itemClicked',\n\t\t\toriginalEvent: event,\n\t\t});\n\t}\n\n\t/**\n\t * Handles the item key down event\n\t * @param {!Event} event\n\t * @protected\n\t */\n\t_handleItemKeyDown(event) {\n\t\tif (event.key === KEY_TAB) {\n\t\t\tconst element = event.delegateTarget;\n\t\t\tconst elementIndex = this._getDropdownItemIndex(element);\n\t\t\tconst totalElements = element.parentElement.querySelectorAll(\n\t\t\t\t'li :not([role=\"presentation\"])'\n\t\t\t).length;\n\n\t\t\tif (\n\t\t\t\t(elementIndex === 0 && event.shiftKey) ||\n\t\t\t\t(elementIndex === totalElements && !event.shiftKey)\n\t\t\t) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tthis.refs.triggerButton.focus();\n\t\t\t} else if (elementIndex === totalElements - 1 && !event.shiftKey) {\n\t\t\t\tthis.toggle();\n\t\t\t\tthis.refs.triggerButton.focus();\n\t\t\t}\n\t\t} else if (event.key === KEY_ESCAPE) {\n\t\t\tthis.toggle();\n\t\t\tthis.refs.triggerButton.focus();\n\t\t}\n\t}\n\n\t/**\n\t * Handle click key code esc and close dropdown.\n\t * @param {!Event} event\n\t * @private\n\t */\n\t_handleKeyup(event) {\n\t\tif (event.keyCode === KEY_CODE_ESC) {\n\t\t\tthis.toggle();\n\t\t}\n\t}\n\n\t/**\n\t * Handle when the lifecycle `rendered` is called in ClayPortal.\n\t * @protected\n\t */\n\t_handleRenderedPortal() {\n\t\tif (this.expanded && this._alignElementSelector) {\n\t\t\tlet alignElement = this.element.querySelector(\n\t\t\t\tthis._alignElementSelector\n\t\t\t);\n\t\t\tif (alignElement) {\n\t\t\t\tlet bodyElement = this.refs.portal.refs.menu;\n\n\t\t\t\tthis._alignedPosition = Align.align(\n\t\t\t\t\tbodyElement,\n\t\t\t\t\talignElement,\n\t\t\t\t\tthis.preferredAlign\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Handles Search in Dropdown.\n\t * @param {!Event} event\n\t * @protected\n\t * @return {Boolean} If the event has been prevented or not.\n\t */\n\t_handleSearch(event) {\n\t\tlet searchValue = event.delegateTarget.value.toLowerCase();\n\n\t\tif (!this._originalItems) {\n\t\t\tthis._originalItems = this.items;\n\t\t}\n\n\t\tthis.items = this._originalItems.filter(item => {\n\t\t\tif (item.items) {\n\t\t\t\tif (!item._originalItems) {\n\t\t\t\t\titem._originalItems = item.items;\n\t\t\t\t}\n\n\t\t\t\titem.items = item._originalItems.filter(nestedItem => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\tnestedItem.label &&\n\t\t\t\t\t\tnestedItem.type !== 'group' &&\n\t\t\t\t\t\tnestedItem.type !== 'header' &&\n\t\t\t\t\t\tnestedItem.type !== 'separator' &&\n\t\t\t\t\t\tnestedItem.label.toLowerCase().indexOf(searchValue) !==\n\t\t\t\t\t\t\t-1\n\t\t\t\t\t);\n\t\t\t\t});\n\n\t\t\t\treturn item.items.length > 0;\n\t\t\t} else {\n\t\t\t\treturn (\n\t\t\t\t\titem.label &&\n\t\t\t\t\titem.type !== 'group' &&\n\t\t\t\t\titem.type !== 'header' &&\n\t\t\t\t\titem.type !== 'separator' &&\n\t\t\t\t\titem.label.toLowerCase().indexOf(searchValue) !== -1\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\n\t\treturn !this.emit({\n\t\t\tdata: {\n\t\t\t\tfilteredItems: this.items,\n\t\t\t\toriginalItems: this._originalItems,\n\t\t\t},\n\t\t\tname: 'itemsFiltered',\n\t\t\toriginalEvent: event,\n\t\t});\n\t}\n\n\t/**\n\t * Handles the key down event over the trigger\n\t * @param {!Event} event\n\t * @protected\n\t */\n\t_handleTriggerKeyDown(event) {\n\t\tif (event.key === KEY_TAB) {\n\t\t\tif (event.shiftKey && this.expanded) {\n\t\t\t\tthis.toggle();\n\t\t\t} else {\n\t\t\t\tlet item = this.refs.portal.refs.item0;\n\n\t\t\t\titem = item.refs.item0 || item;\n\n\t\t\t\tif (item) {\n\t\t\t\t\titem.element.focus();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Handles blur window in order to hide menu.\n\t * @private\n\t */\n\t_handleWinBlur() {\n\t\tconst activeElement = document.activeElement;\n\t\tif (activeElement != null && activeElement.nodeName === 'IFRAME') {\n\t\t\tthis.toggle();\n\t\t}\n\t}\n\n\t/**\n\t * Increments to the index to the next item.\n\t * @param {Array} items\n\t * @param {Number} active\n\t * @param {Number} subActive\n\t * @param {Boolean} reverse\n\t * @private\n\t * @return {Object}\n\t */\n\t_incrementActiveItemIndex(items, active, subActive, reverse) {\n\t\tconst totalItems = items.length;\n\n\t\tsubActive = reverse ? subActive - 1 : subActive + 1;\n\n\t\tif (reverse) {\n\t\t\tif (subActive < 0) {\n\t\t\t\tconst nextActive = active - 1;\n\n\t\t\t\tactive = nextActive < 0 ? totalItems - 1 : nextActive;\n\n\t\t\t\tsubActive = items[active].length - 1;\n\t\t\t}\n\t\t} else {\n\t\t\tif (subActive === items[active].length) {\n\t\t\t\tconst nextActive = active + 1;\n\n\t\t\t\tactive = nextActive === totalItems ? 0 : nextActive;\n\n\t\t\t\tsubActive = 0;\n\t\t\t}\n\t\t}\n\n\t\treturn {active, subActive};\n\t}\n\n\t/**\n\t * Sets the next item in the list as active.\n\t * @param {Boolean} reverse\n\t * @private\n\t */\n\t_setNextActive(reverse) {\n\t\tconst items = flatten(this.items, true);\n\t\tlet activeSubIndex = -1;\n\n\t\tconst activeIndex = items.findIndex(item => {\n\t\t\tconst subIndex = item.findIndex(item => item.active);\n\n\t\t\tif (subIndex !== -1) {\n\t\t\t\tactiveSubIndex = subIndex;\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\n\t\tconst {active, subActive} = this._getNextIndexes(\n\t\t\titems,\n\t\t\tactiveIndex,\n\t\t\tactiveSubIndex,\n\t\t\treverse\n\t\t);\n\n\t\tif (items[activeIndex] && items[activeIndex][activeSubIndex]) {\n\t\t\titems[activeIndex][activeSubIndex].active = false;\n\t\t}\n\n\t\titems[active][subActive].active = true;\n\n\t\tthis.items = this._assembleFromFlattenedGroups(items);\n\t}\n\n\t/**\n\t * Set preferred alignment with Align API.\n\t * @private\n\t * @param {!string} value\n\t * @return {number}\n\t */\n\t_setPreferredAlign(value) {\n\t\tswitch (value) {\n\t\tcase 'TopCenter':\n\t\t\treturn Align.TopCenter;\n\t\tcase 'RightCenter':\n\t\t\treturn Align.RightCenter;\n\t\tcase 'BottomCenter':\n\t\t\treturn Align.BottomCenter;\n\t\tcase 'LeftCenter':\n\t\t\treturn Align.LeftCenter;\n\t\tcase 'TopRight':\n\t\t\treturn Align.TopRight;\n\t\tcase 'BottomRight':\n\t\t\treturn Align.BottomRight;\n\t\tcase 'BottomLeft':\n\t\t\treturn Align.BottomLeft;\n\t\tcase 'TopLeft':\n\t\t\treturn Align.TopLeft;\n\t\tdefault:\n\t\t\treturn Align.BottomLeft;\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tsyncExpanded() {\n\t\tif (this.expanded) {\n\t\t\tthis._eventHandler.add(\n\t\t\t\tdom.on(\n\t\t\t\t\tdocument,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis._handleDocClick.bind(this),\n\t\t\t\t\ttrue\n\t\t\t\t),\n\t\t\t\tdom.on(\n\t\t\t\t\tdocument,\n\t\t\t\t\t'touchend',\n\t\t\t\t\tthis._handleDocClick.bind(this),\n\t\t\t\t\ttrue\n\t\t\t\t),\n\t\t\t\tdom.on(window, 'blur', this._handleWinBlur.bind(this), true)\n\t\t\t);\n\t\t} else if (this._eventHandler.eventHandles_.length) {\n\t\t\tthis._eventHandler.removeAllListeners();\n\t\t}\n\t}\n\n\t/**\n\t * Propagate the event toggle.\n\t * @param {!Event} event\n\t * @return {Boolean} If the event has been prevented or not.\n\t */\n\ttoggle(event) {\n\t\treturn !this.emit({\n\t\t\tname: 'toggle',\n\t\t\toriginalEvent: event,\n\t\t});\n\t}\n}\n\n/**\n * State definition.\n * @static\n * @type {!Object}\n */\nClayDropdownBase.STATE = {\n\t/**\n\t * The current position of the tooltip after being aligned via `Align.align`.\n\t * @default Align.isValidPosition\n\t * @instance\n\t * @memberof ClayDropdownBase\n\t * @type {!number}\n\t */\n\t_alignedPosition: Config.validator(Align.isValidPosition).internal(),\n\n\t/**\n\t * Element selector used to position dropdown according to trigger position.\n\t * @default .dropdown-toggle\n\t * @instance\n\t * @memberof ClayDropdownBase\n\t * @type {?string}\n\t */\n\t_alignElementSelector: Config.string()\n\t\t.value('.dropdown-toggle')\n\t\t.internal(),\n\n\t/**\n\t * Button configuration to place a button at dropdown footer.\n\t * @default undefined\n\t * @instance\n\t * @memberof ClayDropdownBase\n\t * @type {?(string|undefined)}\n\t */\n\tbutton: Config.shapeOf({\n\t\thref: Config.string(),\n\t\tlabel: Config.string().required(),\n\t\tstyle: Config.oneOf(['primary', 'secondary']).value('primary'),\n\t\ttype: Config.oneOf(['button', 'reset', 'submit']).value('button'),\n\t}),\n\n\t/**\n\t * Caption text of the dropdown.\n\t * @default undefined\n\t * @instance\n\t * @memberof ClayDropdownBase\n\t * @type {?(string|undefined)}\n\t */\n\tcaption: Config.string(),\n\n\t/**\n\t * Content Renderer name of items.\n\t * @default undefined\n\t * @instance\n\t * @memberof ClayDropdownBase\n\t * @type {?(string|undefined)}\n\t */\n\tcontentRenderer: Config.string(),\n\n\t/**\n\t * Data to add to the element.\n\t * @default undefined\n\t * @instance\n\t * @memberof ClayDropdownBase\n\t * @type {?object}\n\t */\n\tdata: Config.object(),\n\n\t/**\n\t * Object that wires events with default listeners\n\t * @default undefined\n\t * @instance\n\t * @memberof ClayDropdownBase\n\t * @review\n\t * @type {?(object|undefined)}\n\t */\n\tdefaultEventHandler: Config.object(),\n\n\t/**\n\t * Flag to indicate if menu is disabled\n\t * @default false\n\t * @instance\n\t * @memberof ClayDropdownBase\n\t * @type {?bool}\n\t */\n\tdisabled: Config.bool().value(false),\n\n\t/**\n\t * CSS classes to be applied to the element.\n\t * @default undefined\n\t * @instance\n\t * @memberof ClayDropdownBase\n\t * @type {?(string|undefined)}\n\t */\n\telementClasses: Config.string(),\n\n\t/**\n\t * Flag to indicate if menu is expanded.\n\t * @default false\n\t * @instance\n\t * @memberof ClayDropdownBase\n\t * @type {?bool}\n\t */\n\texpanded: Config.bool().value(false),\n\n\t/**\n\t * Help text to be shown on top of the open dropdown.\n\t * @default undefined\n\t * @instance\n\t * @memberof ClayDropdownBase\n\t * @type {?(string|undefined)}\n\t */\n\thelpText: Config.string(),\n\n\t/**\n\t * Id to be applied to the element.\n\t * @default undefined\n\t * @instance\n\t * @memberof ClayDropdownBase\n\t * @type {?(string|undefined)}\n\t */\n\tid: Config.string(),\n\n\t/**\n\t * List of menu items.\n\t * @default undefined\n\t * @instance\n\t * @memberof ClayDropdownBase\n\t * @type {!array}\n\t */\n\titems: itemsValidator.required(),\n\n\t/**\n\t * Position in which item icons will be placed. Needed if any item has icons.\n\t * @default undefined\n\t * @instance\n\t * @memberof ClayDropdownBase\n\t * @type {?(string|undefined)}\n\t */\n\titemsIconAlignment: Config.oneOf(['left', 'right', 'left-right']),\n\n\t/**\n\t * Label of the trigger button.\n\t * @default undefined\n\t * @instance\n\t * @memberof ClayDropdownBase\n\t * @type {!(html|string)}\n\t */\n\tlabel: Config.any().required(),\n\n\t/**\n\t * Id to be used for portal element.\n\t * @default clay_dropdown_portal\n\t * @instance\n\t * @memberof ClayDropdownBase\n\t * @type {!string}\n\t */\n\tportalElementId: Config.string()\n\t\t.value('clay_dropdown_portal')\n\t\t.internal(),\n\n\t/**\n\t * The preferred alignment for the dropdown content.\n\t * @default BottomLeft\n\t * @instance\n\t * @memberof ClayDropdownBase\n\t * @type {?(string|undefined)}\n\t */\n\tpreferredAlign: preferredAlign\n\t\t.setter('_setPreferredAlign')\n\t\t.value('BottomLeft'),\n\n\t/**\n\t * Flag to indicate if menu has a search field and search through elements\n\t * is possible.\n\t * @default false\n\t * @instance\n\t * @memberof ClayDropdownBase\n\t * @type {?bool}\n\t */\n\tsearchable: Config.bool().value(false),\n\n\t/**\n\t * The path to the SVG spritemap file containing the icons.\n\t * @default undefined\n\t * @instance\n\t * @memberof ClayDropdownBase\n\t * @type {?(string|undefined)}\n\t */\n\tspritemap: Config.string(),\n\n\t/**\n\t * Style of the trigger button.\n\t * @default unstyled\n\t * @instance\n\t * @memberof ClayDropdownBase\n\t * @type {?string}\n\t */\n\tstyle: Config.oneOf(['link', 'primary', 'secondary', 'unstyled']).value(\n\t\t'unstyled'\n\t),\n\n\t/**\n\t * Aria label attribute for the trigger element.\n\t * @default undefined\n\t * @instance\n\t * @memberof ClayDropdownBase\n\t * @type {?(string|undefined)}\n\t */\n\ttriggerAriaLabel: Config.string(),\n\n\t/**\n\t * CSS classes to be applied to the trigger element.\n\t * @default undefined\n\t * @instance\n\t * @memberof ClayDropdownBase\n\t * @type {?(string|undefined)}\n\t */\n\ttriggerClasses: Config.string(),\n\n\t/**\n\t * Size of the trigger button.\n\t * @default undefined\n\t * @instance\n\t * @memberof ClayDropdownBase\n\t * @type {?(string|undefined)}\n\t */\n\ttriggerSize: Config.oneOf(['sm']),\n\n\t/**\n\t * The title attribute of the trigger element.\n\t * @default undefined\n\t * @instance\n\t * @memberof ClayDropdownBase\n\t * @type {?(string|undefined)}\n\t */\n\ttriggerTitle: Config.string(),\n};\n\nSoy.register(ClayDropdownBase, templates);\n\nexport {ClayDropdownBase, flatten};\nexport default ClayDropdownBase;\n"]}