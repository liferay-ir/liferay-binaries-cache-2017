{"version":3,"sources":["../../src/__tests__/index.test.js"],"names":["fixturesDir","join","__dirname","describe","it","config","log","rootPkgJson","require","pkg","source","pkgJson","expect","dependencies","toEqual","messages","toHaveLength","toMatchObject","level","things","toBe","toString","toMatch"],"mappings":"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","file":"index.test.js","sourcesContent":["/**\n * Â© 2017 Liferay, Inc. <https://liferay.com>\n *\n * SPDX-License-Identifier: LGPL-3.0-or-later\n */\n\nimport PkgDesc from 'liferay-npm-build-tools-common/lib/pkg-desc';\nimport PluginLogger from 'liferay-npm-build-tools-common/lib/plugin-logger';\nimport path from 'path';\nimport plugin from '../index';\n\nconst fixturesDir = path.join(__dirname, '__fixtures__');\n\ndescribe('when using regular packages', () => {\n\tit('injects peer dependencies as needed', () => {\n\t\tconst config = {};\n\t\tconst log = new PluginLogger();\n\t\tconst rootPkgJson = require(`${fixturesDir}/project/package.json`);\n\t\tconst pkg = new PkgDesc(\n\t\t\t'pkg-with-peer-deps',\n\t\t\t'1.0.0',\n\t\t\t`${fixturesDir}/project/node_modules/pkg-with-peer-deps`,\n\t\t\ttrue\n\t\t);\n\t\tconst source = {\n\t\t\tpkg,\n\t\t};\n\t\tconst pkgJson = require(fixturesDir +\n\t\t\t'/project/node_modules/pkg-with-peer-deps/package.json');\n\n\t\tplugin({config, log, rootPkgJson, pkg, source}, {pkgJson});\n\n\t\texpect(pkgJson.dependencies).toEqual({\n\t\t\t'number-is-nan': '1.0.0',\n\t\t});\n\t});\n});\n\ndescribe('when using scoped packages', () => {\n\tit('injects peer dependencies for regular packages', () => {\n\t\tconst config = {};\n\t\tconst log = new PluginLogger();\n\t\tconst rootPkgJson = require(`${fixturesDir}/project/package.json`);\n\t\tconst pkg = new PkgDesc(\n\t\t\t'@scope/pkg-with-peer-deps',\n\t\t\t'1.0.0',\n\t\t\t`${fixturesDir}/project/node_modules/@scope/pkg-with-peer-deps`,\n\t\t\ttrue\n\t\t);\n\t\tconst source = {\n\t\t\tpkg,\n\t\t};\n\t\tconst pkgJson = require(fixturesDir +\n\t\t\t'/project/node_modules/@scope/pkg-with-peer-deps/package.json');\n\n\t\tplugin({config, log, rootPkgJson, pkg, source}, {pkgJson});\n\n\t\texpect(pkgJson.dependencies).toEqual({\n\t\t\t'@scope/number-is-nan': '1.0.0',\n\t\t});\n\t});\n\n\tit('injects peer dependencies for namespaced packages', () => {\n\t\tconst config = {};\n\t\tconst log = new PluginLogger();\n\t\tconst rootPkgJson = require(`${fixturesDir}/project/package.json`);\n\t\tconst pkg = new PkgDesc(\n\t\t\t'@project$1.0.0$scope/pkg-with-peer-deps',\n\t\t\t'1.0.0',\n\t\t\tfixturesDir +\n\t\t\t\t'/project/node_modules/@project$1.0.0$scope/pkg-with-peer-deps',\n\t\t\ttrue\n\t\t);\n\t\tconst source = {\n\t\t\tpkg,\n\t\t};\n\t\tconst pkgJson = require(fixturesDir +\n\t\t\t'/project/node_modules/@project$1.0.0$scope/pkg-with-peer-deps' +\n\t\t\t'/package.json');\n\n\t\tplugin({config, log, rootPkgJson, pkg, source}, {pkgJson});\n\n\t\texpect(pkgJson.dependencies).toEqual({\n\t\t\t'@project$scope/number-is-nan': '1.0.0',\n\t\t});\n\t});\n});\n\nit('logs results correctly', () => {\n\tconst config = {};\n\tconst log = new PluginLogger();\n\tconst rootPkgJson = require(`${fixturesDir}/project/package.json`);\n\tconst pkg = new PkgDesc(\n\t\t'pkg-for-logs',\n\t\t'1.0.0',\n\t\t`${fixturesDir}/project/node_modules/pkg-for-logs`,\n\t\ttrue\n\t);\n\tconst source = {\n\t\tpkg,\n\t};\n\tconst pkgJson = require(fixturesDir +\n\t\t'/project/node_modules/pkg-for-logs/package.json');\n\n\tplugin({config, log, rootPkgJson, pkg, source}, {pkgJson});\n\n\texpect(log.messages).toHaveLength(2);\n\texpect(log.messages[0]).toMatchObject({\n\t\tlevel: 'info',\n\t\tsource: 'inject-peer-dependencies',\n\t\tthings: ['Injected dependency', 'number-is-nan@1.0.0'],\n\t});\n\texpect(log.messages[1]).toMatchObject({\n\t\tlevel: 'warn',\n\t\tsource: 'inject-peer-dependencies',\n\t});\n\texpect(log.messages[1].things).toHaveLength(4);\n\texpect(log.messages[1].things[0]).toBe('Failed to resolve dependency');\n\texpect(log.messages[1].things[1]).toBe('missing-dep');\n\texpect(log.messages[1].things[2]).toBe('with error:');\n\texpect(log.messages[1].things[3].toString()).toMatch(\n\t\t/Error: Cannot find module 'missing-dep\\/package.json' from '.*'/\n\t);\n});\n"]}