define(["exports","metal-component/src/all/component","metal/src/metal","metal-state/src/all/state","html2incdom/src/withParser","metal-incremental-dom/src/IncrementalDomRenderer","./SoyAop","metal-soy-bundle/build/bundle"],function(e,t,n,r,o,a,i){"use strict";function l(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(e,"__esModule",{value:!0}),e.validators=e.SoyAop=e.Soy=e.Config=void 0;var f=l(o),p=l(a),d=l(i),y=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),g=function b(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:b(o,t,n)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(n)},m={},v=function(e){function r(){return u(this,r),c(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return s(r,e),y(r,[{key:"getExtraDataConfig",value:function(e){var t=e.constructor.TEMPLATE;if((0,n.isFunction)(t)){t=d["default"].getOriginalFn(t),this.soyParamTypes_=t.types||{};for(var r=t.params||[],o={},a=0;a<r.length;a++)e[r[a]]||(o[r[a]]={});return o}}},{key:"buildTemplateData_",value:function(e,t){var r=this,o=n.object.mixin({},this.getConfig(e));e.getStateKeys().forEach(function(t){var n=e[t];r.isHtmlParam_(e,t)&&(n=h.toIncDom(n)),o[t]=n});for(var a=0;a<t.length;a++)!o[t[a]]&&(0,n.isFunction)(e[t[a]])&&(o[t[a]]=e[t[a]].bind(e));return(0,n.isFunction)(e.prepareStateForRender)?e.prepareStateForRender(o)||o:o}},{key:"getTemplate",value:function(e,t){return function(n,r,o){if(!goog.loadedModules_[e])throw new Error('No template with namespace "'+e+'" has been loaded yet.');return goog.loadedModules_[e][t](n,r,o)}}},{key:"handleInterceptedCall_",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[e.componentCtor,null,[]];for(var r in t)n.push(r,t[r]);IncrementalDOM.elementVoid.apply(null,n)}},{key:"isHtmlParam_",value:function(e,t){var n=e.getDataManager().getStateInstance(e);if(n.getStateKeyConfig(t).isHtml)return!0;var r=d["default"].getOriginalFn(e.constructor.TEMPLATE),o=(r.types||{})[t]||"";return o.split("|").indexOf("html")!==-1}},{key:"register",value:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"render";e.RENDERER=h,e.TEMPLATE=d["default"].getOriginalFn(n[r]),e.TEMPLATE.componentCtor=e,d["default"].registerForInterception(n,r),t.ComponentRegistry.register(e)}},{key:"renderIncDom",value:function(e){var t=e.constructor.TEMPLATE;if((0,n.isFunction)(t)&&!e.render){t=d["default"].getOriginalFn(t),d["default"].startInterception(this.handleInterceptedCall_);var o=this.buildTemplateData_(e,t.params||[]);t(o,null,m),d["default"].stopInterception()}else g(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"renderIncDom",this).call(this,e)}},{key:"setInjectedData",value:function(e){m=e||{}}},{key:"shouldUpdate",value:function(e,t){var n=g(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"shouldUpdate",this).call(this,e,t);if(!n||e.shouldUpdate)return n;for(var o=e.constructor.TEMPLATE,a=o?d["default"].getOriginalFn(o).params:[],i=0;i<a.length;i++)if(t.props[a[i]])return!0;return!1}},{key:"toHtmlString",value:function(e){var t=document.createElement("div");return IncrementalDOM.patch(t,e),t.innerHTML}},{key:"toIncDom",value:function(e){return(0,n.isObject)(e)&&(0,n.isString)(e.content)&&"HTML"===e.contentKind&&(e=e.content),(0,n.isString)(e)&&(e=f["default"].buildFn(e)),e}}]),r}(p["default"].constructor),h=new v;h.RENDERER_NAME="soy",e["default"]=h,e.Config=r.Config,e.Soy=h,e.SoyAop=d["default"],e.validators=r.validators});