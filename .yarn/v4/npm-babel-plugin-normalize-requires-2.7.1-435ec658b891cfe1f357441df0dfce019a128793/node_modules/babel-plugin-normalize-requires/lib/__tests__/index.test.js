'use strict';

var _babelCore = require('babel-core');

var babel = _interopRequireWildcard(_babelCore);

var _babelIpc = require('liferay-npm-build-tools-common/lib/babel-ipc');

var babelIpc = _interopRequireWildcard(_babelIpc);

var _pluginLogger = require('liferay-npm-build-tools-common/lib/plugin-logger');

var _pluginLogger2 = _interopRequireDefault(_pluginLogger);

var _index = require('../index');

var _index2 = _interopRequireDefault(_index);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

/**
 * Â© 2017 Liferay, Inc. <https://liferay.com>
 *
 * SPDX-License-Identifier: LGPL-3.0-or-later
 */

var logger = void 0;

beforeEach(function () {
	babelIpc.set(__filename, {
		log: logger = new _pluginLogger2.default()
	});
});

it('logs results correctly', function () {
	var source = '\n\trequire(\'a-package.js\');\n\trequire(\'./a-module.js\');\n\t';

	babel.transform(source, {
		filenameRelative: __filename,
		plugins: [_index2.default]
	});

	expect(logger.messages).toMatchSnapshot();
});

describe('when requiring package default modules', function () {
	it('keeps trailing ".js" from package names', function () {
		var source = '\n\t\trequire(\'a-package.js\')\n\t\t';

		var _babel$transform = babel.transform(source, {
			filenameRelative: __filename,
			plugins: [_index2.default]
		}),
		    code = _babel$transform.code;

		expect(code).toMatchSnapshot();
	});

	it('keeps trailing ".js" from scoped package names', function () {
		var source = '\n\t\trequire(\'@some-scope/a-package.js\')\n\t\t';

		var _babel$transform2 = babel.transform(source, {
			filenameRelative: __filename,
			plugins: [_index2.default]
		}),
		    code = _babel$transform2.code;

		expect(code).toMatchSnapshot();
	});
});

describe('when requiring local modules', function () {
	it('removes trailing ".js" from module names', function () {
		var source = '\n\t    require(\'./a-module.js\')\n\t    ';

		var _babel$transform3 = babel.transform(source, {
			filenameRelative: __filename,
			plugins: [_index2.default]
		}),
		    code = _babel$transform3.code;

		expect(code).toMatchSnapshot();
	});

	it('removes trailing "/" from module names', function () {
		var source = '\n\t\trequire(\'./a-module/\')\n\t    ';

		var _babel$transform4 = babel.transform(source, {
			filenameRelative: __filename,
			plugins: [_index2.default]
		}),
		    code = _babel$transform4.code;

		expect(code).toMatchSnapshot();
	});

	it('only removes trailing "/" from module names ending in ".js"', function () {
		var source = '\n\t\trequire(\'./a-module.js/\')\n\t    ';

		var _babel$transform5 = babel.transform(source, {
			filenameRelative: __filename,
			plugins: [_index2.default]
		}),
		    code = _babel$transform5.code;

		expect(code).toMatchSnapshot();
	});
});

describe('when requiring external modules', function () {
	it('removes trailing ".js" from module names', function () {
		var source = '\n\t\trequire(\'a-package/a-module.js\')\n\t    ';

		var _babel$transform6 = babel.transform(source, {
			filenameRelative: __filename,
			plugins: [_index2.default]
		}),
		    code = _babel$transform6.code;

		expect(code).toMatchSnapshot();
	});

	it('removes trailing "/" from module names', function () {
		var source = '\n\t\trequire(\'a-package/a-module/\')\n\t    ';

		var _babel$transform7 = babel.transform(source, {
			filenameRelative: __filename,
			plugins: [_index2.default]
		}),
		    code = _babel$transform7.code;

		expect(code).toMatchSnapshot();
	});

	it('only removes trailing "/" from module names ending in ".js"', function () {
		var source = '\n\t\trequire(\'a-package/a-module.js/\')\n\t\t';

		var _babel$transform8 = babel.transform(source, {
			filenameRelative: __filename,
			plugins: [_index2.default]
		}),
		    code = _babel$transform8.code;

		expect(code).toMatchSnapshot();
	});
});
//# sourceMappingURL=index.test.js.map